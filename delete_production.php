<?php
session_start();
include "./db.php"; 

// р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡ session username р╕лр╕гр╕╖р╕нр╣Др╕бр╣И (р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в)
if (!isset($_SESSION['username'])) {
    echo json_encode(['success' => false, 'message' => 'р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕нр╕Щр╕╕р╕Нр╕▓р╕Х']);
    exit();
}

// р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕Др╣Ир╕▓ id р╕бр╕▓р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
if (isset($_POST['id'])) {
    $id = mysqli_real_escape_string($conn, $_POST['id']);
    
    // р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕│р╕кр╕▒р╣Ир╕З SQL р╣Ар╕Юр╕╖р╣Ир╕нр╕ер╕Ъ
    // ЁЯФ┤ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕лр╣Йр╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Хр╕▓р╕гр╕▓р╕Зр╕Кр╕╖р╣Ир╕н production_cycles р╣Бр╕ер╕░р╕Др╕нр╕ер╕▒р╕бр╕Щр╣М PK р╕Кр╕╖р╣Ир╕н id
    $query = "DELETE FROM production_cycles WHERE id = '$id'"; 
    
    if (mysqli_query($conn, $query)) {
        // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Бр╕▓р╕гр╕ер╕Ър╣Ар╕Бр╕┤р╕Фр╕Вр╕╢р╣Йр╕Щр╕Ир╕гр╕┤р╕З
        if (mysqli_affected_rows($conn) > 0) {
            echo json_encode(['success' => true, 'message' => 'р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з']);
        } else {
            echo json_encode(['success' => false, 'message' => 'р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ъ']);
        }
    } else {
        // р╕Бр╕гр╕Ур╕╡ Query р╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓
        echo json_encode(['success' => false, 'message' => 'р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф: ' . mysqli_error($conn)]);
    }
} else {
    // р╕Бр╕гр╕Ур╕╡р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕кр╣Ир╕З ID р╕бр╕▓
    echo json_encode(['success' => false, 'message' => 'р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕░р╕Ър╕╕ ID р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ъ']);
}
?>